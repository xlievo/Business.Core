
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>APIs Documents</title>
    <link rel="shortcut icon" href="/doc2/w9.ico" />

    <link rel="stylesheet" type="text/css" href="/doc2/bootstrap-3.3.7/css/bootstrap.min.css">
    <!-- JSON Schema Based Editor -->
    <script src="/doc2/jsoneditor/jsoneditor.min.js"></script>
    <!-- Collapse -->
    <link rel="stylesheet" type="text/css" href="/doc2/houdini/css/houdini.min.css">
    <script src="/doc2/houdini/js/houdini.polyfills.min.js"></script>
    <!-- Ajax request -->
    <script src="/doc2/atomic/atomic.polyfills.min.js"></script>
    <!-- Ajax.org Cloud9 Editor -->
    <script src="/doc2/ace/ace.js"></script>
    <!-- juicer -->
    <script type="text/javascript" src="/doc2/Juicer/juicer-min.js"></script>

    <style type="text/css">
        /*.tab-content well well-small {
            padding-top: 0px;
            padding-right: 0px;
            padding-bottom: 0px;
            padding-left: 0px;
            border-top-width: 0px;
            border-right-width: 0px;
            border-bottom-width: 0px;
            border-left-width: 0px;
            margin-bottom: 0px;
        }*/

        .panel-padding {
            padding-top: 10px;
            padding-bottom: 10px;
            padding-right: 10px;
            padding-left: 10px;
        }
    </style>

    <script>
        // Set the default CSS theme and icon library globally
        JSONEditor.defaults.theme = 'bootstrap3';
        JSONEditor.defaults.iconlib = 'bootstrap3';
        JSONEditor.defaults.options.disable_properties = true;
        JSONEditor.defaults.options.required_by_default = true;
        JSONEditor.defaults.options.disable_edit_json = true;
    </script>
</head>
<body>

    <div class='container'>


        <div class='medium-12-columns'>
            <button id='submit' class='tiny'>Submit (console.log)</button>
            <button id='restore' class='secondary tiny'>Restore to Default</button>
            <span id='valid_indicator' class='label'></span>
        </div>

        <!-- ============================= -->
        <div class="panel-group" id="members" />
        <!-- ============================= -->
        <div id="t" />

    </div>

    <script id="tpl" type="text/template">
        {@each _ as member}
        <div class="panel panel-info">
            <div class="panel-heading">
                <h4>
                    <span class="d-inline-block">${member.Name}</span>
                    <span class="pull-right">
                        <a data-houdini-toggle="${member.Name}_member">Detailed description</a>
                    </span>
                </h4>
                {@if member.Summary !== null && member.Summary !== 'null'}
                <hr>
                <p class="mb-0">${member.Summary}</p>
                {@/if}
            </div>
            <div data-houdini id='${member.Name}_member' class="panel-padding">
                <div id='${member.Name}_input'></div>
                <div id='${member.Name}_out'></div>
                <div id='${member.Name}_sdk'></div>
            </div>
        </div>
        {@/each}
    </script>

    <script>

        atomic("http://localhost:5000/API.doc")
            .then(function (response) {
                console.log(response.data); // xhr.responseText
                //console.log(response.xhr);  // full response
                var doc = response.data;

                var members = doc.Members["j"];
                var members2 = []
                for (var i in members) {
                    members2.push(members[i]);
                }

                var tpl = document.getElementById('tpl').innerHTML;
                var html = juicer(tpl, members2);
                document.getElementById('members').innerHTML = html;

                //=============================================//
                members2.forEach(c => {

                    var member = c;

                    //==================input==================//
                    var inputid = member.Name + '_input';

                    var input = {
                        title: "Input",
                        type: "object",
                        properties: {
                            t: {
                                id: member.Name + '.t',
                                title: "t (String)",
                                type: "string",
                                description: "API token"
                            },
                            d: {
                                id: member.Name + '.d',
                                title: "d (JsonArray)",
                                type: "object",
                                description: "API data",
                                properties: {}
                            }
                        }
                    };

                    var token = false;
                    for (var i in member.properties) {
                        if (member.properties[i].token) {
                            token = true;
                        } else {
                            input.properties.d.properties[i] = member.properties[i];
                        }
                    }

                    if (!token) {
                        delete input.properties.t;
                    }

                    new JSONEditor(document.getElementById(inputid), {
                        // The schema for the editor
                        schema: input
                    });
                    //========================================//

                    //==================sdk==================//
                    var outid = member.Name + '_out';
                    var sdkid = member.Name + '_sdk';
                    new JSONEditor(document.getElementById(sdkid), {
                        // Enable fetching schemas via ajax
                        //ajax: true,
                        schema: {
                            title: "SDK",
                            type: "object",
                            format: "categories",
                            properties: {
                                NET: getSdk("json"),
                                Java: getSdk("java"),
                                PHP: getSdk("php")
                            }
                        }

                        // Seed the form with a starting value
                        , startval: {
                            "NET": {
                                "value": "{\n  \"type\": \"string\",\n  \"format\": \"json\",\n  \"options\": {\n    \"ace\": {\n      \"theme\": \"ace/theme/vibrant_ink\",\n      \"tabSize\": 2,\n      \"useSoftTabs\": true,\n      \"wrap\": true,\n      \"readOnly\": true,\n      \"newLineMode\": \"windows\"\n    }\n  }\n}"
                            },
                            "Java": {
                                "value": "{\n  \"type\": \"string\",\n  \"format\": \"json\",\n  \"options\": {\n    \"ace\": {\n      \"theme\": \"ace/theme/vibrant_ink\",\n      \"tabSize\": 2,\n      \"useSoftTabs\": true,\n      \"wrap\": true,\n      \"readOnly\": true,\n      \"newLineMode\": \"windows\"\n    }\n  }\n}"
                            },
                            "PHP": {
                                "value": "{\n  \"type\": \"string\",\n  \"format\": \"json\",\n  \"options\": {\n    \"ace\": {\n      \"theme\": \"ace/theme/vibrant_ink\",\n      \"tabSize\": 2,\n      \"useSoftTabs\": true,\n      \"wrap\": true,\n      \"readOnly\": true,\n      \"newLineMode\": \"windows\"\n    }\n  }\n}"
                            }
                        }
                    });

                    document.querySelector('#' + sdkid + ' > div > div.well.well-sm > div > div').style.cssText = 'padding: 0px;border: 0px;margin: 0px;';
                    //========================================//
                });

                document.querySelectorAll('#NET > div > div > h3').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#Java > div > div > h3').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#PHP > div > div > h3').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#NET > div > div > div.well.well-sm > div > div > div > div > div.form-group > label').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#Java > div > div > div.well.well-sm > div > div > div > div > div.form-group > label').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#PHP > div > div > div.well.well-sm > div > div > div > div > div.form-group > label').forEach(c => c.style.display = 'none');

                new Houdini('[data-houdini]');
            })
            .catch(function (error) {
                console.log(error.status); // xhr.status
                //console.log(error.statusText); // xhr.statusText
                return null;
            });

        function getSdk(format) {
            return {
                type: "object",
                properties: {
                    value: {
                        type: "string",
                        format: format,
                        options: {
                            ace: {
                                theme: "ace/theme/vibrant_ink",
                                useWorker: false,
                                tabSize: 2,
                                readOnly: true,
                                highlightActiveLine: false,
                                highlightSelectedWord: false,
                                minLines: 20,
                                maxLines: 100
                            }
                        }
                    }
                },
                options: {
                    collapsed: false,
                    disable_collapse: true
                }
            };
        }

        function getData(editor, args) {
            for (var i = args.length - 1; i >= 0; i--) {
                args[i] = JSON.stringify(editor.getEditor(args[i]).getValue());
            }
            return JSON.stringify(args)
        }

        /*
        // Hook up the Restore to Default button
        document.getElementById('restore').addEventListener('click', function () {
            editor.setValue(starting_value);
        });

        // Hook up the validation indicator to update its
        // status whenever the editor changes
        editor.on('change', function () {
            // Get an array of errors from the validator
            var errors = editor.validate();

            var indicator = document.getElementById('valid_indicator');

            // Not valid
            if (errors.length) {
                indicator.className = 'label alert';
                indicator.textContent = 'not valid';
            }
            // Valid
            else {
                indicator.className = 'label success';
                indicator.textContent = 'valid';
            }
        });
        */


    </script>
</body>
</html>
