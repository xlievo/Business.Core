
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>APIs Documents</title>
    <link rel="shortcut icon" href="/doc2/w9.ico" />

    <link rel="stylesheet" type="text/css" href="/doc2/bootstrap-3.3.7/css/bootstrap.min.css">
    <!-- JSON Schema Based Editor -->
    <script src="/doc2/jsoneditor/jsoneditor.min.js"></script>
    <!-- Collapse -->
    <link rel="stylesheet" type="text/css" href="/doc2/houdini/css/houdini.min.css">
    <script src="/doc2/houdini/js/houdini.polyfills.min.js"></script>
    <!-- Ajax request -->
    <script src="/doc2/atomic/atomic.polyfills.min.js"></script>
    <!-- Ajax.org Cloud9 Editor -->
    <script src="/doc2/ace/ace.js"></script>
    <!-- juicer -->
    <script type="text/javascript" src="/doc2/Juicer/juicer-min.js"></script>

    <style type="text/css">
    </style>

    <script>
        //const choices = new Choices("choices-single-no-search");

        // Set the default CSS theme and icon library globally
        JSONEditor.defaults.theme = 'bootstrap3';
        JSONEditor.defaults.iconlib = 'bootstrap3';
        JSONEditor.defaults.options.disable_properties = true;
        JSONEditor.defaults.options.required_by_default = true;
        JSONEditor.defaults.options.disable_edit_json = true;
        //JSONEditor.defaults.options.disable_collapse = true;

        var Theme = JSONEditor.defaults.themes.bootstrap3;
        JSONEditor.defaults.themes.bootstrap3 = function () {
            var theme = new Theme();
            theme.getHeader = function (text) {
                var el = document.createElement('h4');
                el.style.marginTop = '0px';
                el.style.marginBottom = '5px';
                if (typeof text === "string") {
                    el.textContent = text;
                }
                else {
                    el.appendChild(text);
                }
                return el;
            };

            theme.getFormControl = function (label, input, description, infoText) {
                var group = document.createElement('div');

                if (label && input.type === 'checkbox') {
                    group.classList.add('checkbox');
                    label.appendChild(input);
                    label.style.fontSize = '14px';
                    group.style.marginTop = '0';
                    if (infoText) group.appendChild(infoText);
                    group.appendChild(label);
                    input.style.position = 'relative';
                    input.style.cssFloat = 'left';
                }
                else {
                    group.classList.add('form-group');
                    if (label) {
                        label.classList.add('control-label');
                        group.appendChild(label);
                        group.style.marginBottom = '8px';
                    }

                    if (infoText) group.appendChild(infoText);
                    group.appendChild(input);
                }

                if (description) {
                    description.style.marginBottom = '5px';
                    group.appendChild(description);
                }

                return group;
            };

            theme.getIndentedPanel = function () {
                var el = document.createElement('div');
                el.classList.add('well', 'well-sm');
                el.style.paddingBottom = '3px';
                el.style.marginTop = '8px';
                return el;
            };

            return theme
        };

        var Iconlibs = JSONEditor.defaults.iconlibs.bootstrap3;
        JSONEditor.defaults.iconlibs.bootstrap3 = function () {
            var icon = new Iconlibs();
            icon.mapping = {
                collapse: 'chevron-down',
                expand: 'chevron-right',
                "delete": 'remove',
                edit: 'edit',
                add: 'plus',
                cancel: 'floppy-remove',
                save: 'floppy-saved',
                moveup: 'arrow-up',
                movedown: 'arrow-down',
                clear: 'remove-circle',
                time: 'time',
                calendar: 'calendar',
                data: 'list-alt'
            };

            return icon;
        };

    </script>
</head>
<body>

    <div class='container'>


        <!--<div class='medium-12-columns'>
            <button id='submit' class='tiny'>Submit (console.log)</button>
            <button id='restore' class='secondary tiny'>Restore to Default</button>
            <span id='valid_indicator' class='label'></span>
        </div>

        <div class="row">
            <div class="col-md-6 col-md-offset-3"
                 style="background-color: #dedef8;box-shadow:
         inset 1px -1px 1px #444, inset -1px 1px 1px #444;">
                <p>
                    Lorem ipsum dolor sit amet, consectetur adipisicing
                    elit.
                </p>
            </div>

        </div>-->

        <div class="input-group input-group-lg" style="padding-top: 20px;
        padding-bottom: 20px;">

            <input type="text" class="form-control">
            <div class="input-group-btn">
                <button class="btn btn-default" type="button">
                    Go!
                </button>
                <select class="btn btn-default dropdown-toggle">
                    <option value="Five">ss</option>
                    <option value="Five" selected="selected">33 </option>
                    <option value="Five">j</option>
                </select>

            </div>
        </div><!-- /input-group -->
        <!-- ============================= -->
        <div class="panel-group" id="members" />
        <!-- ============================= -->
    </div>

    <script id="tpl" type="text/template">
        {@each _ as member}
        <div class="panel panel-info">
            <div class="panel-heading">
                <h4>
                    <span class="d-inline-block">${member.name}</span>
                    <span class="pull-right">
                        <a data-houdini-toggle="${member.name}_member">Detailed description</a>
                    </span>
                </h4>
                {@if member.description !== null && member.description !== 'null'}
                <hr>
                <p class="mb-0">${member.description}</p>
                {@/if}
            </div>
            <div data-houdini id='${member.name}_member' style="padding: 10px">
                <div id='${member.name}_input' style="padding-top: 10px;"></div>
                <!--<div id='${member.name}_input' style="padding-top: 10px;"></div>-->
                <!--<div id='${member.name}_out' style="padding-top: 10px;"></div>-->
                <div id='${member.name}_sdk' style="padding-top: 10px;"></div>
            </div>
        </div>
        {@/each}
    </script>

    <script>

        //const choices = new Choices("select");

        atomic("http://localhost:5000/API.doc")
            .then(function (response) {
                console.log(response.data); // xhr.responseText
                //console.log(response.xhr);  // full response
                var doc = response.data;

                var members = doc.members["j"];
                var members2 = []
                for (var i in members) {
                    members2.push(members[i]);
                }

                var tpl = document.getElementById('tpl').innerHTML;
                var html = juicer(tpl, members2);
                document.getElementById('members').innerHTML = html;

                //=============================================//
                members2.forEach(member => {
                    //==================input==================//
                    var inputid = member.name + '_input';

                    var input = {
                        title: "Input",
                        type: "object",
                        edit: false,
                        properties: {
                            t: {
                                id: member.name + '.t',
                                title: "t (String)",
                                type: "string",
                                options: {
                                    inputAttributes: {
                                        placeholder: "API token"
                                    }
                                }
                            },
                            d: {
                                id: member.name + '.d',
                                title: "d (JsonArray)",
                                type: "object",
                                description: "API data",
                                properties: {}
                            }
                        }
                    };

                    var token = false;
                    for (var i in member.properties) {
                        if (member.properties[i].token) {
                            token = true;
                        } else {
                            input.properties.d.properties[i] = member.properties[i];
                        }
                    }

                    if (!token) {
                        delete input.properties.t;
                    }

                    var inputeditor = new JSONEditor(document.getElementById(inputid), {
                        // The schema for the editor
                        schema: input
                    });

                    ready(setEdit(inputeditor, inputid), inputid);
                    //========================================//

                    //==================sdk==================//
                    var outid = member.name + '_out';
                    var sdkid = member.name + '_sdk';
                    new JSONEditor(document.getElementById(sdkid), {
                        // Enable fetching schemas via ajax
                        //ajax: true,
                        schema: {
                            title: "SDK",
                            type: "object",
                            format: "categories",
                            properties: {
                                NET: getSdk("json"),
                                Java: getSdk("java"),
                                PHP: getSdk("php")
                            }
                        }

                        // Seed the form with a starting value
                        , startval: {
                            "NET": {
                                "value": "{\n  \"type\": \"string\",\n  \"format\": \"json\",\n  \"options\": {\n    \"ace\": {\n      \"theme\": \"ace/theme/vibrant_ink\",\n      \"tabSize\": 2,\n      \"useSoftTabs\": true,\n      \"wrap\": true,\n      \"readOnly\": true,\n      \"newLineMode\": \"windows\"\n    }\n  }\n}"
                            },
                            "Java": {
                                "value": "{\n  \"type\": \"string\",\n  \"format\": \"json\",\n  \"options\": {\n    \"ace\": {\n      \"theme\": \"ace/theme/vibrant_ink\",\n      \"tabSize\": 2,\n      \"useSoftTabs\": true,\n      \"wrap\": true,\n      \"readOnly\": true,\n      \"newLineMode\": \"windows\"\n    }\n  }\n}"
                            },
                            "PHP": {
                                "value": "{\n  \"type\": \"string\",\n  \"format\": \"json\",\n  \"options\": {\n    \"ace\": {\n      \"theme\": \"ace/theme/vibrant_ink\",\n      \"tabSize\": 2,\n      \"useSoftTabs\": true,\n      \"wrap\": true,\n      \"readOnly\": true,\n      \"newLineMode\": \"windows\"\n    }\n  }\n}"
                            }
                        }
                    });

                    document.querySelector('#' + sdkid + ' > div > div.well.well-sm > div > div').style.cssText = 'padding: 0px;border: 0px;margin: 0px;';
                    //========================================//
                });

                document.querySelectorAll('#NET > div > div > h4').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#Java > div > div > h4').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#PHP > div > div > h4').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#NET > div > div > div.well.well-sm > div > div > div > div > div.form-group > label').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#Java > div > div > div.well.well-sm > div > div > div > div > div.form-group > label').forEach(c => c.style.display = 'none');
                document.querySelectorAll('#PHP > div > div > div.well.well-sm > div > div > div > div > div.form-group > label').forEach(c => c.style.display = 'none');

                new Houdini('[data-houdini]');
            })
            .catch(function (error) {
                console.log(error.status); // xhr.status
                //console.log(error.statusText); // xhr.statusText
                return null;
            });

        function setEdit2(p, edit) {
            if ("object" == p.type) {
                for (var i in p.properties) {
                    setEdit2(p.properties[i], edit);
                }
            }
            else {
                if (!edit) {
                    if (!p.editData) {
                        p.editData = { type: null, format: null };
                    }
                    if (p.type) {
                        p.editData.type = p.type;
                    }
                    if (p.format) {
                        p.editData.format = p.format;
                    }
                    p.type = "string";
                    p.format = "hidden";
                    if (p.options && p.options.inputAttributes && p.options.inputAttributes.placeholder) {
                        p.description = p.options.inputAttributes.placeholder;
                    }
                }
                else {
                    if (p.editData) {
                        p.type = p.editData.type;
                        p.format = p.editData.format;
                    }
                    if (p.description) {
                        if (!p.options) {
                            p.options = {};
                        }
                        if (!p.options.inputAttributes) {
                            p.options.inputAttributes = {};
                        }
                        p.options.inputAttributes.placeholder = p.description;
                    }
                    p.description = null;
                }
            }
        }

        function setEdit(editor, id) {
            var schema = editor.getEditor('root').schema;
            for (var i in schema.properties) {
                setEdit2(schema.properties[i], schema.edit);
            }
            schema.edit = !schema.edit;

            if (editor) {
                editor.destroy();
            }
            editor = new window.JSONEditor(document.getElementById(id), {
                schema: schema
            });

            //console.log(schema);

            return editor;
        }

        function ready(editor, id) {
            editor.on('ready', function () {
                var buttonData = editor.root.getButton('', 'data', 'Data');
                button_holder = editor.root.editors.d.theme.getHeaderButtonHolder();
                button_holder.appendChild(buttonData);
                editor.root.editors.d.header.parentNode.appendChild(button_holder);
                buttonData.addEventListener('click', function (e) {
                    e.preventDefault();
                    editor.root.editors.d.container.hidden = true;
                }, false);

                //======================================================//

                var buttonEdit = editor.root.getButton('', 'edit', 'Edit');
                button_holder = editor.root.theme.getHeaderButtonHolder();
                button_holder.appendChild(buttonEdit);
                editor.root.header.parentNode.appendChild(button_holder);
                buttonEdit.addEventListener('click', function (e) {
                    e.preventDefault();
                    ready(setEdit(editor, id), id);
                }, false);
            });
        }

        function getSdk(format) {
            return {
                type: "object",
                properties: {
                    value: {
                        type: "string",
                        format: format,
                        options: {
                            ace: {
                                theme: "ace/theme/vibrant_ink",
                                useWorker: false,
                                tabSize: 2,
                                readOnly: true,
                                highlightActiveLine: false,
                                highlightSelectedWord: false,
                                minLines: 20,
                                maxLines: 100
                            }
                        }
                    }
                },
                options: {
                    collapsed: false,
                    disable_collapse: true
                }
            };
        }

        function getData(editor, args) {
            for (var i = args.length - 1; i >= 0; i--) {
                args[i] = JSON.stringify(editor.getEditor(args[i]).getValue());
            }
            return JSON.stringify(args)
        }

        /*
        // Hook up the Restore to Default button
        document.getElementById('restore').addEventListener('click', function () {
            editor.setValue(starting_value);
        });

        // Hook up the validation indicator to update its
        // status whenever the editor changes
        editor.on('change', function () {
            // Get an array of errors from the validator
            var errors = editor.validate();

            var indicator = document.getElementById('valid_indicator');

            // Not valid
            if (errors.length) {
                indicator.className = 'label alert';
                indicator.textContent = 'not valid';
            }
            // Valid
            else {
                indicator.className = 'label success';
                indicator.textContent = 'valid';
            }
        });
        */


    </script>
</body>
</html>
